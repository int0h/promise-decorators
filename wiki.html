<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
<script type="text/javascript" src="lodash.js"></script>
<script type="text/javascript" src="asyncTransform.js">

</script>

<input type="text" id="text" />
<i id='loader' style='display: none'>loading...</i>
<ul id='results'>
</ul>

<script type="text/javascript">

	text = document.getElementById('text');
	results = document.getElementById('results');
	loader = document.getElementById('loader');

	const searchWiki = text => fetch(`https://en.wikipedia.org//w/api.php?action=opensearch&format=json&origin=*&search=${encodeURIComponent(text)}&limit=10`);

	const tlSearch = watchPromise(
		takeLast(
			asyncTransform(
				searchWiki, fn => _.throttle(fn, 300)
			)
		),
		status => {
			loader.style.display = status === 'pending' ? 'block' : 'none'
			results.style.display = status === 'pending' ? 'none' : 'block'
		}
	);

	text.oninput = () => text.value.length > 2 && tlSearch(text.value)
		.then(res => res.json())
		.then(res => results.innerHTML = res[1].map(item => `<li>${item}</li>`).join(''));

</script>

</body>
</html>